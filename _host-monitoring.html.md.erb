<%# WARNING!!!! %>
<%# DO NOT ADD READBILITY LINE WRAPPING TO THIS CONTENT THE LONG LINES MUSt REMAIN TO CORRECTLY FORMAT THE FOLLOWING SECTION'S MARKDOWN CONTENT %>
<%# <!-- WARNING!!!! --> %>

The **Host Monitoring** pane provides settings for
monitoring host VMs in your <%= vars.product_short %> deployment.
In this pane, you can configure <%= vars.product_short %> to
forward logs from your BOSH-deployed VMs to a syslog endpoint as well as
configure transport of multiple metric sources.

![Host Monitoring pane](images/host-monitoring.png)

To configure host monitoring in the <%= vars.product_tile %> tile, do the following:

* If you want to enable Syslog for BOSH-deployed VMs, see [Syslog](#host-syslog).
<% if current_page.data.iaas == "vSphere" || current_page.data.iaas == "vSphere-NSX-T" %>
* If you want to enable VMware vRealize Log Insight Integration, see [VMware vRealize Log Insight Integration](#vrealize-logs).
<% end %>
* If you want to enable configure the Telegraf agent, see [Telegraf](#telegraf).

####<a id='host-syslog'></a> Syslog

1. Click **Host Monitoring**.
1. Under **Enable Syslog for PKS**, select **Yes**.
1. Under **Address**, enter the destination syslog endpoint.
1. Under **Port**, enter the destination syslog port.
1. Under **Transport Protocol**, select a transport protocol for log forwarding.
1. (Optional) To enable TLS encryption during log forwarding, complete the following steps:
  1. Ensure **Enable TLS** is selected.
  <p class="note"><strong>Note</strong>: Logs may contain sensitive information, such as cloud provider credentials.
  Pivotal strongly recommends that you enable TLS encryption for log forwarding.
  </p>
  1. Under **Permitted Peer**, provide the accepted fingerprint (SHA1) or name of remote peer. For example, `*.YOUR-LOGGING-SYSTEM.com`.
  1. Under **TLS Certificate**, provide a TLS certificate for the destination syslog endpoint.
  <p class="note"><strong>Note</strong>: You do not need to provide a new certificate if the TLS certificate for the destination syslog endpoint is signed by a Certificate Authority (CA) in your BOSH certificate store.
  </p>
1. (Optional) Under **Max Message Size**, enter a maximum message size for logs that are forwarded to a syslog endpoint. By default, the **Max Message Size** field is 10,000 characters.
1. Click **Save**.

<% if current_page.data.iaas == "vSphere" || current_page.data.iaas == "vSphere-NSX-T" %>
####<a id='vrealize-logs'></a> VMware vRealize Log Insight Integration
<%= partial 'vrealize-logs' %>
<% end %>

####<a id='telegraf'></a> Telegraf

The Telegraf agent collects metrics from your <%= vars.product_short %> deployment
and sends them to a monitoring service, such as Wavefront or Datadog.

You can configure the Telegraf agent to collect metrics
from one or more of the following sources:

<table class="nice">
  <col width="30%">
  <col width="70%">
  <tr>
    <th>Source</th>
    <th>Includes metrics fromâ€¦</th>
    </tr>
    <tr>
      <td>
        <strong>PKS API</strong>
      </td>
      <td>
        <ul>
          <li>Node Exporter</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td>
        <strong>Master nodes</strong>
      </td>
      <td>
        <p>One or more of the following:</p>
        <ul>
          <li>Node Exporter</li>
          <li>Kubernetes API server</li>
          <li>Kubernetes controller manager</li>
          <li>etcd</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td>
        <strong>Worker nodes</strong>
      </td>
      <td>
      <p>One or more of the following:</p>
        <ul>
          <li>Node Exporter</li>
          <li>kubelet</li>
        </ul>
      </td>
    </tr>
</table>

**The Prometheus Node Exporter in <%= vars.product_short %>:** You can enable Node Exporter
on worker and master nodes as well as on the <%= vars.control_plane %> VM.
For security, <%= vars.product_short %> enables Node Exporter only on <em>localhost</em> of these VMs.
If you enable Node Exporter on worker nodes,
cluster users cannot see that Node Exporter is running on their worker nodes.
For the full list of Node Exporter metrics collected in <%= vars.product_short %>,
see the [Node Exporter](https://github.com/prometheus/node_exporter#enabled-by-default) GitHub repository.

To configure <%= vars.product_short %> to use Telegraf for metric collection:

1. Create a configuration file for your monitoring service.
For instructions, see [Create a Configuration File](./monitor-etcd.html#toml).

1. Return to the <%= vars.product_tile %> tile > **Settings** > **Host Monitoring**.

3. Under **Enable Telegraf Outputs?**, select **Yes**.

2. Configure the Telegraf checkboxes as described in the table below.

    Any components you enable in this step will be visible, in a running <%= vars.product_short %> environment, only to PKS operators.

    <table class="nice">
      <col width="30%">
      <col width="70%">
      <tr>
        <th>Checkbox</th>
        <th>Enable if you want to send the following metrics to your monitoring service...</th>
      </tr>
      <tr>
        <td>
          <strong>Enable Node Exporter on PKS API</strong>
        </td>
        <td>
          This includes Node Exporter metrics from the <%= vars.control_plane %> VM.
        </td>
      </tr>
      <tr>
        <td>
          <strong>Enable Node Exporter on master</strong>
        </td>
        <td>
          This includes Node Exporter metrics from Kubernetes master nodes.
        </td>
      </tr>
      <tr>
        <td>
          <strong>Include etcd metrics</strong>
        </td>
        <td>
          This includes etcd server and debugging metrics.
        </td>
      </tr>
      <tr>
        <td>
          <strong>Enable Node Exporter on worker</strong>
        </td>
        <td>
          This includes Node Exporter metrics from Kubernetes worker nodes.
        </td>
      </tr>
      <tr>
        <td>
          <strong>Include Kubernetes controller manager metrics</strong>
        </td>
        <td>
          This includes Kubernetes controller manager metrics, which provides information about the state of each cluster.</p>
        </td>
      </tr>
      <tr>
        <td>
          <strong>Include Kubernetes API server metrics</strong>
        </td>
        <td>
          This includes Kubernetes API server metrics.
        </td>
      </tr>
      <tr>
        <td>
          <strong>Include kubelet metrics</strong>
        </td>
        <td>
          This includes kubelet metrics for all workloads running in all your Kubernetes clusters.
          If you enable <strong>Include kubelet metrics</strong>, be prepared for a high volume of metrics.
        </td>
      </tr>
    </table>

1. In **Set Up Telegraf Outputs**, replace the default value `[[outputs.discard]]` with the contents of the configuration file
    that you created above. See the following example for an HTTP output plugin:

    ```
    [[outputs.http]]
       url="https://example.com"
       method="POST"
       data_format="json"
    [[processors.override]]
      [processors.override.tags]
        director = "bosh-director-1"
    ```

1. Click **Save**.

<%# WARNING!!!! %>
<%# <!-- DO NOT ADD READBILITY LINE WRAPPING TO THIS CONTENT THE LONG LINES MUSt REMAIN TO CORRECTLY FORMAT THE FOLLOWING SECTION'S MARKDOWN CONTENT  %>
<%#  WARNING!!!! %>
