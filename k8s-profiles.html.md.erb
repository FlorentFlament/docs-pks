---
title: Kubernetes Profiles
owner: PKS
---

This topic describes how <%= vars.product_full %> administrators and cluster managers create and use K8s profiles for Kubernetes clusters provisioned by <%= vars.product_short %>. 
It also lists verified use cases for K8s profiles on <%= vars.product_short %>.

## <a id="overview"></a> Overview

K8s profiles enable cluster administrators and cluster managers to customize Kubernetes component settings for any clusters that they provision.

To use K8s profiles, <%= vars.product_short %> users:

1. Create JSON configuration files that set configuration options for any Kubernetes components, such as `kube-apiserver` on the control plane or the `kubelet` on each node.
1. Use the PKS CLI to create the K8s profile in <%= vars.product_short %>.
1. Use the PKS CLI to apply the profile to clusters.

Verified uses for K8s profiles include TK specifying an encryption provider for etcd secrets and limiting audit log size. 

### <a id="who"></a> Who Creates and Manage K8s Profiles

Users with the `pks.clusters.admin` or `pks.clusters.manage` roles can create and use K8s profiles.

If user with the `pks.clusters.admin-read-only` role attempts to create a K8s profile, they see the following error:

```
You do not have enough privileges to perform this action. Please contact the PKS administrator.
```

### <a id="validated"></a> Validated vs Experimental Customizations

A K8s profile configures settings for Kubernetes components in two JSON code blocks,  `customizations` and `experimental_customizations`.
See [K8s Profile Format](#format) for details.
The code blocks differ as follows:

* `customizations` block
  - PKS checks the validity of configurations in this block.
	If you run `pks create-k8s-profile` on a profile with invalid configurations in `customizations`, the command returns an error.
	- The PKS team supports clusters configured with tested, validated parameters in this block.

* `experimental_customizations` block
  - PKS imposes no restrictions on the contents of this block.
	- Configurations in this block are neither tested nor supported.
  - If a customer wants to use an unsupported configuration, they should contact the PKS team with the parameters that they want tested, validated, and supported.

## <a id="create"></a> Create a K8s Profile

To create a K8s profile in <%= vars.product_short %>, you:

1. Define a K8s profile in a JSON configuration file, following the [Network Profile Format](#format) below.

1. Use the PKS CLI to define the K8s profile within <%= vars.product_short %>, as described in [The create-network-profile Command](#run-create), below.

### <a id="format"></a> K8s Profile Format

To create a K8s profile, you must first define it as a JSON file that specifies network parameters, listed in [K8s Profile Parameters](#params) below.

Here is the basic structure of a K8s profile.

```
{
    "name": "my-profile-1",
    "description": "My profile description",
    "customizations": [
        {
           "component": "k8s-component-name",
           "arguments": {
                "key": "value,value,value"
            },
            "file-arguments": {
                "key": "local file path"
            }
            
        }
    ],
    "experimental_customizations": [
        {
            
        }
    ]
}
```

Here is an example k8s profile:

```
    "name": "my-profile-1",
    "description": "My profile description",
    "customizations": [
        {
            "component": "kube-apiserver",
            "arguments": {
                "audit-log-maxsize": "1000"
            }
        }
    ],
    "experimental_customizations": [
        {
            "component": "kubelet",
            "arguments": {
                "maximum-dead-containers": "1000",
                "feature-gates": "APIListChunking=true, AttachVolumeLimit=false"
            }
        }
    ]
}
```

<p class="note"><strong>Note:</strong> This example K8s profile is for illustration purposes only. It is not intended to be used as a template for K8s profile definition.</p>

### <a id="params"></a> K8s Profile Parameters

The K8s profile JSON can include the following parameters:

<table id='params' border="1" class="nice" >
  <tr>
    <th>Parameter</th>
    <th>Type</th>
    <th>Description</th>
  </tr><tr>
    <td><code>name</code><sup>&#42;</sup></td>
    <td>String</td>
    <td>Name of the K8s profile.</td>
  </tr><tr>
    <td><code>description</code></td>
    <td>String</td>
    <td>Description of the K8s profile.</td>
  </tr><tr>
    <td><code>customizations</code><sup>&#42;</sup></td>
    <td>Map</td>
    <td>A block that defines supported, validated<br>
		K8s options using the <code>component</code>, <code>arguments</code>,<br>
		and <code>file-arguments</code> parameters below.</td>
  </tr><tr>
    <td><code>experimental_<br>
		customizations</code></td>
    <td>Map</td>
    <td>A block that defines unsupported, unvalidated<br>
		K8s options using the <code>component</code>, <code>arguments</code>,<br>
		and <code>file-arguments</code> parameters below.</td>
  </tr><tr>
    <td><code>component</code><sup>&#42;</sup></td>
    <td>String</td>
    <td>The name of a K8s component, <br>
		e.g. <code>kubelet</code>, <code>kube-apiserver</code>.</td>
  </tr><tr>
    <td><code>arguments</code><sup>&#42;</sup></td>
    <td>Map</td>
    <td>Parameters for each component, as one or more Key:Value pairs.<br>Multiple values must be separated by commas, without spaces.</td>
  </tr><tr>
    <td><code>file-arguments</code><sup>&#42;</sup></td>
    <td>Map</td>
    <td>Parameters whose values are stored as files<br>
		on the local machine.</td>
  </tr>
</table>

<sup>&#42;</sup>Parameters marked with an `*` are mandatory.

<p class="note"><strong>Note:</strong> If you specify the same parameter in both <code>customizations</code> and <code>experimental_customizations</code>, the one in <code>customization</code> takes precedence.</p>

### <a id="run-create"></a> The create-k8s-profile Command

After defining a K8s profile in a JSON file as described in [K8s Profile Format](#format),
a cluster administrator or manager creates the K8s profile by running the following PKS CLI command:

```
pks create-k8s-profile PATH-TO-YOUR-K8S-PROFILE-CONFIGURATION
``` 
Where `PATH-TO-YOUR-K8S-PROFILE-CONFIGURATION` is the path to the JSON file
you created when defining the K8s profile.

For example:

<pre class="terminal">
cat profile3-docs.json
{
    "name": "my-profile3",
    "description": "My profile description",
    "customizations": [
        {
            "component": "kube-apiserver",
            "arguments": {
                "audit-log-maxsize": "1000"
            }
        }
    ],
    "experimental_customizations": [
        {
            "component": "kubelet",
            "arguments": {
                "maximum-dead-containers": "1000",
                "feature-gates": "APIListChunking=true,AttachVolumeLimit=false"
            }
        }
    ]
}
ybabar ~/workspace: ./pks create-k8s-profile k8s-profile3.json 
Kubernetes profile my-profile3 successfully created 
</pre>

## <a id="manage"></a> Manage K8s Profiles

<%= vars.product_short %> cluster administrators and managers can perform the following operations on K8s profiles and the clusters that use them.

### <a id="list"></a> List K8s Profiles

To list available K8s profiles, run the following command:

```
pks k8s-profiles
```

For example:

<pre class="terminal">
$ pks k8s-profiles
K8s-profile        Owner     Created Date
Basic-k8s-profile  Alana     Tue, 05 Nov 2019 16:28:15 PST
</pre>

The command output differs by user role:
- `pks.cluster.admin` see a list of K8s profiles that all users created
- `pks.cluster.manage` see a list of only the K8s profiles that they created

### <a id="delete"></a> Delete a K8s Profile

To delete a K8s profile, run the following command:

```
pks delete-k8s-profile K8S-PROFILE-NAME
```

Where `K8S-PROFILE-NAME` is the name of the K8s profile you want to delete.

For example:

<pre class="terminal">
$ ybabar ~/workspace: ./pks delete-k8s-profile my-profile3 
Are you sure you want to delete the kubernetes profile my-profile3? (y/n): y
Deletion of my-profile3 completed
</pre>

<p class="note"><strong>Note:</strong> You cannot delete a K8s profile that is in use.
Before deleting a K8s profile, you must disassociate it from all clusters or delete all clusters it is associated with.</p>

Both `pks.clusters.admin` and `pks.clusters.manage` users can
delete k8s profiles. 
If a `pks.clusters.admin-read-only` user attempts to delete
a K8s profile, they see the following error:

```
You do not have enough privileges to perform this action. Please contact the PKS administrator.
```

### <a id="view"></a> View K8s Profile Details

To view details of a K8s profile, run the following command:

```
pks k8s-profile K8S-PROFILE-NAME
```

Where `K8S-PROFILE-NAME` is the name of the K8s profile you want to view.

For example:

<pre class="terminal">
pks k8s-profile Basic-k8s-profile
Name:                    Basic-k8s-profile
Owner:                   Alana
Created Date             Tue, 05 Nov 2019 16:28:15 PST
Description:             K8s profile for customer A
â€¦.
&lt;KEY&gt; :                  &lt;VALUE&gt;
</pre>

* Users with the `pks.cluster.admin` can view the details of any K8s profile; users with the `pks.cluster.manage` role can view details of K8s profiles that they created.
* Once you create or update a cluster with an encryption profile, you cannot assign any other k8s profiles to that cluster.
Because decryption is not straightforward, applying another profile can have nondeterministic outcome.

### <a id='new-cluster'></a> Create a Cluster with a K8s Profile

You can assign a K8s profile to a Kubernetes cluster at the time of cluster creation.

To create an <%= vars.product_short %>-provisioned Kubernetes cluster with a K8s profile, run the following command:

```
pks create-cluster CLUSTER-NAME --external-hostname HOSTNAME --plan PLAN-NAME --k8s-profile K8S-PROFILE-NAME
```

Where:

* `CLUSTER-NAME` is a unique name for your cluster.
* `HOSTNAME` is your external hostname used for accessing the Kubernetes API.
* `PLAN-NAME` is the name of the <%= vars.product_short %> plan you want to use for your cluster.
* `K8S-PROFILE-NAME` is the name of the K8s profile you want to use for your cluster.

### <a id="update"></a> Assign a K8s Profile to an Existing Cluster

PKS supports changing the K8s profile for an already created cluster.
You can use this procedure to:

- assign a K8s profile to a cluster that does not have one, or
- change a cluster's existing profile to a new one

This is the procedure to change a cluster's K8s profile:

1. Do one of the following
	- Choose a new K8s profile for the cluster.
	See [List K8s profiles](#list).
	- Define and create a new K8s profile as described in [Create a K8s Profile](#create). 
  		- The name of the new K8s profile must be unique and different from the previously assigned K8s profile.

1. Run the following command to update the cluster with the new K8s profile:

    ```
    pks update-cluster CLUSTER-NAME --k8s-profile NEW-K8S-PROFILE-NAME
    ```

    Where: 
    * `CLUSTER-NAME` is the name of the existing Kubernetes cluster 
    * `NEW-KUBERNETES-PROFILE-NAME` is the name of the new K8s profile you want to apply to the cluster.


## <a id='use-cases'></a> K8s Profile Use Cases

K8s profiles let you customize Kubernetes configuration parameters at the time of cluster creation. Use cases for K8s profiles include:

<%= partial 'k8s-profiles-uses' %>
