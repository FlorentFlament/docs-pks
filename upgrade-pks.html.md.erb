---
title: Upgrading PKS
owner: PKS
topictype: vsphereupgrade
---

<strong><%= modified_date %></strong>

This topic explains how to upgrade the Pivotal Container Service (PKS) tile and existing Kubernetes clusters.

For conceptual information about upgrading the PKS tile and PKS-provisioned Kubernetes clusters, 
see [What Happens During PKS Upgrades](understanding-upgrades.html).

<p class="note warning"><strong>WARNING</strong>: Do not manually upgrade your Kubernetes version. The PKS service includes the compatible Kubernetes version.</p>

For information about upgrading PKS on vSphere with NSX-T integration, see
[Upgrading PKS with NSX-T](upgrade-pks-nsxt.html).

## <a id="before"></a>Before You Upgrade

This section describes the activities you must perform before upgrading PKS.

### <a id="upgrade-path"></a> Determine Your Upgrade Path

Use the following table to determine your upgrade path to PKS v1.2.x.

<table>
<tr>
  <th>If your current version of PKS is...</th>
  <th>Then use the following upgrade path:</th>
</tr>
<tr>
  <td>v1.1.4 or earlier</td>
  <td>
    <ol>
        <li>Upgrade to PKS v1.1.5 or later.</li>
        <li>(Optional) Upgrade to Ops Manager v2.2.3 or later, or Ops Manager v2.3.1 or later.</li>
    </ol>
  </td>
</tr>
<tr>
  <td>v1.1.5 or later</td>
  <td>
    <ol>
        <li>Upgrade to Ops Manager v2.2.3 or later, or Ops Manager v2.3.1 or later.</li>
        <li>Upgrade to PKS v1.2.6.</li>
        <li>(Optional) Upgrade to Ops Manager v2.4.0 or later.</li>
    </ol>
  </td>
</tr>
<tr>
  <td>v1.2.6 to v1.2.8</td>
  <td>
    <ol>
        <li>Follow the procedures in <a href='https://community.pivotal.io/s/article/pks-upgrade-approach-for-critical-cve'>
        PKS upgrade approach for CRITICAL CVE: 2019-3779 (67116)</a> in the Pivotal Support Knowledge Base to upgrade to PKS v1.2.x.</li>
    </ol>
  </td>
</tr>
<tr>
  <td>v1.2.9 or later</td>
  <td>
    <ol>
        <li>Upgrade to PKS v1.2.10 or later.</li>
        <li>(Optional) Upgrade to Ops Manager v2.4.0 or later.</li>
    </ol>
  </td>
</tr>
</table>

<p class="note"><strong>Note:</strong> PKS v1.2 has reached end of support life and is no longer supported. You can instead upgrade PKS v1.2.7 and later to PKS v1.3 by following the procedures in <a href='https://community.pivotal.io/s/article/pks-upgrade-approach-for-critical-cve'> PKS upgrade approach for CRITICAL CVE: 2019-3779 (67116)</a> in the Pivotal Support Knowledge Base.
</p>

### <a id="prepare"></a>Prepare to Upgrade

Before you begin upgrading the PKS tile, perform the following steps:

1. Review the [Release Notes](release-notes.html) for the version or versions of PKS you are upgrading to.

1. Review [What Happens During PKS Upgrades](understanding-upgrades.html), and consider your workload capacity and uptime requirements.

1. View your workload resource usage in Dashboard. For more information, see [Accessing Dashboard](access-dashboard.html).
  1. If workers are operating too close to their capacity, the PKS upgrade can fail. To prevent workload downtime during a cluster upgrade, Pivotal recommends running your workload on at least three worker VMs, using multiple replicas of your workloads spread across those VMs. For more information, see [Maintaining Workload Uptime](maintain-uptime.html).
  1. If your clusters are near capacity for your existing infrastructure, Pivotal recommends scaling up your clusters before you upgrade.
Scale up your cluster by running `pks resize` or create a cluster using a larger plan. For more information, see [Scaling Existing Clusters](scale-clusters.html).

1. Verify that your Kubernetes environment is healthy. To verify the health of your Kubernetes environment, see [Verify Kubernetes Health](verify-health.html#k8s).

1. (Optional) Back up the PKS v1.1 control plane. For more information, see "Backing up the PKS Control Plane" in the [PKS v1.1 documentation (PDF)](https://docs.pivotal.io/archives/pks-1-1.pdf).

### <a id="upgrade-pks"></a> Step 1: Upgrade to PKS v1.1.5 or Later

Skip this step if you are already running PKS v1.1.5+.

Follow the procedures detailed in "Upgrading PKS" in the [PKS v1.1 documentation (PDF)](https://docs.pivotal.io/archives/pks-1-1.pdf).

### <a id="upgrade-opsman"></a> Step 2: Upgrade to Ops Manager v2.3.1+

Skip this step if you are already running Ops Manager v2.3.1+.

Before you upgrade to PKS v1.2.x, you must upgrade to Ops Manager v2.3.1+.
 
1. Follow the procedures in [Upgrade Ops Manager and Installed Products to v2.3](https://docs.pivotal.io/pivotalcf/2-3/customizing/upgrading-pcf.html#upgrade_ops).

1. <%= partial 'add-clusters-workloads' %>

## <a id="upgrade"></a> During the Upgrade

This section describes the steps required to upgrade to PKS v1.2.x.

### <a id="upgrade-tile"></a> Step 3: Upgrade to PKS v1.2.6

You can upgrade both PKS v1.1.5 and PKS v1.1.6 to PKS v1.2.6.  

<p class="note warning"><strong>WARNING</strong>: PKS v1.2.8 and earlier include a critical CVE. When upgrading to PKS versions beyond 1.2.5 it is critical that you implement and maintain an ETCD certificate trust chain. Follow the procedures in the <a href="https://community.pivotal.io/s/article/pks-upgrade-approach-for-critical-cve">PKS upgrade approach for CRITICAL CVE: 2019-3779 (67116)</a> article in the Pivotal Support Knowledge Base to perform an upgrade to PKS v1.2.9.
</p>

<p class="note warning"><strong>Warning:</strong> PKS versions v1.2.4 and earlier must first be upgraded to either PKS v1.2.6 or PKS v1.2.5 before upgrading to PKS v1.2.7.
</p>

#### <a id="import"></a> Import the Tile

1. Review the [PKS Release Notes](release-notes.html) for the version you are upgrading to.

1. Download the PKS v1.2.6 tile from [Pivotal Network](https://network.pivotal.io/products/pivotal-container-service/).

1. Navigate to the Ops Manager Installation Dashboard and click **Import a Product** to upload the product file.

1. Under the **Import a Product** button, click **+** next to **Pivotal Container Service**. This adds the tile to your staging area.

<p class="note"><strong>Note:</strong> During an upgrade your existing configuration settings automatically migrate to the new version.</p>

### <a id="stemcell"></a> Step 4: Download and Import the Stemcell

PKS v1.2.x uses a [Xenial stemcell](https://docs.pivotal.io/pivotalcf/stemcells/#xenial). 

If Ops Manager does not have the Xenial stemcell required for PKS, the PKS tile displays the message **Missing stemcell**. 

<p class="note"><strong>Note:</strong> If the <b>Stemcell Library</b> in Ops Manager already has a compatible Xenial stemcell, the <b>Missing stemcell</b> link does not appear. You do not need to download or import a new stemcell and can skip this step.</p>

To download and import a new Xenial stemcell, follow the steps below:

1. On the **Pivotal Container Service** tile, click the **Missing stemcell** link.

    <img src="images/missing_stemcell.png" alt="Verify stemcell assignment">

1. In the **Stemcell Library**, locate Pivotal Container Service and note the required stemcell version.

1. Visit the [Stemcells for PCF (Ubuntu Xenial)](https://network.pivotal.io/products/stemcells-ubuntu-xenial/) page on Pivotal Network, 
and download the required stemcell version appropriate for your IaaS.

1. Return to the **Installation Dashboard** in Ops Manager, and click **Stemcell Library**.

1. On the **Stemcell Library** page, click **Import Stemcell** and select the stemcell file you downloaded from Pivotal Network.

1. Select Pivotal Container Service and click **Apply Stemcell to Products**.

1. Verify that Ops Manager successfully applied the stemcell. The stemcell version you imported and applied appears in the **Staged** column for Pivotal Container Service.

1. Select the **Installation Dashboard** link to return to the Installation Dashboard.

### <a id="worker-nodes"></a> Step 5: Verify Errand Configuration

To verify that errands are configured correctly in the PKS tile, perform the following steps.

1. Click the newly-added **Pivotal Container Service** tile.

1. Click **Errands**.

1. Under **Post-Deploy Errands**, verify that the **Upgrade all clusters errand** is set to **Default (On)**. The errand upgrades a single Kubernetes cluster at a time. Upgrading PKS Kubernetes clusters can temporarily interrupt the service, as described in [Service Interruptions](interruptions.html).

    <p class="note warning"><strong>WARNING</strong>: If you are upgrading PKS, you must enable the <strong>Upgrade All Clusters</strong> errand.</p>

1. Review the other configuration panes. Click **Save** on any panes where you make changes.
    <p class="note"><strong>Note</strong>: When you upgrade PKS, you must place singleton jobs in the AZ you selected when you first installed the PKS tile. You cannot move singleton jobs to another AZ.</p>

### <a id="apply-changes"></a> Step 6: Apply Changes to the PKS Tile

Perform the following steps to complete the upgrade to the PKS tile.

1. Return to the **Installation Dashboard** in Ops Manager.

1. If you are using Ops Manager v2.2, click **Review Pending Changes [BETA]**. 
     For more information about this Ops Manager page, see
    [Reviewing Pending Product Changes](https://docs.pivotal.io/pivotalcf/2-2/customizing/review-pending-changes.html).

1. If you are using Ops Manager v2.3, click **Review Pending Changes**.
   For more information about this Ops Manager page, see
    [Reviewing Pending Product Changes](https://docs.pivotal.io/pivotalcf/2-3/customizing/review-pending-changes.html).

1. Click **Apply Changes**. 

1. (Optional) To monitor the progress of the **Upgrade all clusters errand** using the BOSH CLI, do the following:
      1. Log in to the BOSH Director by running `bosh -e MY-ENVIRONMENT log-in` from a VM that can access your PKS deployment. For more information, see [Managing PKS Deployments with BOSH](manage-deployments-bosh.html).
      1. Run `bosh -e MY-ENVIRONMENT tasks`.
      1. Locate the task number for the errand in the <strong>&#35;</strong> column of the BOSH output.
      1. Run `bosh task TASK-NUMBER`, replacing `TASK-NUMBER` with the task number you located in the previous step.

## <a id="after-upgrade"></a> After the Upgrade

After you complete the upgrade to PKS v1.2.6, complete the following verifications and upgrades.

### <a id="upgrade-opsman-2"></a> (Optional) Step 7: Upgrade to Ops Manager v2.4.x

To upgrade to Ops Manager v2.4.x, perform the following steps:

1. Follow the procedures in [Upgrade Ops Manager and Installed Products to v2.4](https://docs.pivotal.io/pivotalcf/2-4/customizing/upgrading-pcf.html#upgrade_ops).

1. <%= partial 'add-clusters-workloads' %>

### <a id="update-clis"></a> Step 8: Update PKS and Kubernetes CLIs

Update the PKS and Kubernetes CLIs on any local machine 
where you run commands that interact with your upgraded version of PKS.

To update your CLIs, download and re-install the PKS and Kubernetes CLI distributions 
that are provided with PKS on Pivotal Network.

For more information about installing the CLIs, see the following topics:

* [Installing the PKS CLI](installing-pks-cli.html)

* [Installing the Kubernetes CLI](installing-kubectl-cli.html)

### <a id="verify-upgrade"></a> Step 9: Verify the Upgrade

After you apply changes to the PKS tile and the upgrade is complete, perform the following steps:

1. Verify that your Kubernetes environment is healthy. To verify the health of your Kubernetes environment, see 
[Verify Kubernetes Health](verify-health.html#k8s).

1. <%= partial 'add-clusters-workloads' %>

### <a id="upgrade-vcenter"></a> (Optional) Step 10: Upgrade vSphere

If you are deploying PKS on vSphere, consult the chart below, and upgrade vSphere if necessary.
<%= partial '_vsphere_versions' %>

## <a id="after-upgrading-to-2-6"></a> Completing the CVE Upgrade Path

It is critical that you upgrade your system beyond PKS v1.2.6 to remove 
<a href="https://pivotal.io/security/cve-2019-3779">Common Vulnerabilities and Exposures (CVE) 2019-3779</a>.  

### <a id="upgrade-beyond-2-6"></a> Step 11: Upgrade from PKS v1.2.6 to PKS v1.2.7

Skip this step if you are already running PKS v1.2.7+.  

You can upgrade PKS v1.2.5 and PKS v1.2.6 directly to PKS v1.2.7. 
PKS versions v1.2.4 and earlier must first be upgraded to PKS v1.2.6, or PKS v1.2.5, before upgrading to PKS v1.2.7.  

<p class="note warning"><strong>WARNING</strong>: PKS v1.2.8 and earlier include a critical CVE. When upgrading to PKS versions beyond 1.2.5 it is critical that you implement and maintain an ETCD certificate trust chain. Follow the procedures in the <a href="https://community.pivotal.io/s/article/pks-upgrade-approach-for-critical-cve">PKS upgrade approach for CRITICAL CVE: 2019-3779 (67116)</a> article in the Pivotal Support Knowledge Base to perform an upgrade to PKS v1.2.9.
</p>

1. Determine your PKS v1.2.7 migration path by reviewing 
[PKS upgrade approach for CRITICAL CVE: 2019-3779 (67116)](https://community.pivotal.io/s/article/pks-upgrade-approach-for-critical-cve)
in the Pivotal Support Knowledge Base.  
1. To upgrade PKS v1.2.6 to PKS v1.2.7, repeat the upgrade procedures described above 
starting with [Step 3: Upgrade to PKS v1.2.6](#upgrade-tile). Note the following PKS v1.2.7-upgrade differences:
    * In [Step 3: Upgrade to PKS v1.2.6](#upgrade-tile), download the PKS v1.2.7 tile, instead of the PKS v1.2.6 tile.

During an upgrade your existing configuration settings automatically 
migrate to the new version. 

### <a id="upgrade-beyond-2-7"></a> Step 12: Upgrade from PKS v1.2.7 to PKS v1.2.8

Skip this step if you are already running PKS v1.2.8+.  

You can upgrade PKS v1.2.7 directly to PKS v1.2.8. 
PKS versions v1.2.5 and v1.2.6 must first be upgraded to PKS v1.2.7 before upgrading to PKS v1.2.8.  

<p class="note warning"><strong>WARNING</strong>: PKS v1.2.8 and earlier include a critical CVE. When upgrading to PKS versions 
  beyond 1.2.5 it is critical that you implement and maintain an ETCD certificate trust chain. Follow the procedures in the 
  <a href="https://community.pivotal.io/s/article/pks-upgrade-approach-for-critical-cve">PKS upgrade approach for CRITICAL CVE: 2019-3779 (67116)</a> 
article in the Pivotal Support Knowledge Base to perform an upgrade to PKS v1.2.9.</p>

<p class="note"><strong>Note:</strong> PKS v1.2 has reached end of support life and is no longer supported. 
  You can instead upgrade PKS v1.2.7 to PKS v1.3.1 by following the procedures in 
  <a href='https://community.pivotal.io/s/article/pks-upgrade-approach-for-critical-cve'>
  PKS upgrade approach for CRITICAL CVE: 2019-3779 (67116)</a> in the Pivotal Support Knowledge Base.
</p>

1. Determine your PKS v1.2.8 migration path by reviewing 
[PKS upgrade approach for CRITICAL CVE: 2019-3779 (67116)](https://community.pivotal.io/s/article/pks-upgrade-approach-for-critical-cve)
in the Pivotal Support Knowledge Base.  
1. To upgrade PKS v1.2.7 to PKS v1.2.8, repeat the upgrade procedures described above 
starting with [Step 3: Upgrade to PKS v1.2.6](#upgrade-tile). Note the following PKS v1.2.8-upgrade differences:
    * In [Step 3: Upgrade to PKS v1.2.6](#upgrade-tile), download the PKS v1.2.8 tile, instead of the PKS v1.2.6 tile.

During an upgrade your existing configuration settings automatically 
migrate to the new version.  

### <a id="upgrade-beyond-2-8"></a> Step 13: Upgrade from PKS v1.2.8 to PKS v1.2.9+

Skip this step if you are already running PKS v1.2.9+.  

You can upgrade PKS v1.2.8 directly to PKS v1.2.9 or later (e.g., PKS v1.2.9, v1.2.10, and v1.2.11). 
PKS version v1.2.7 must first be upgraded to PKS v1.2.8 before upgrading to PKS v1.2.9 or later.  

<p class="note warning"><strong>Warning:</strong> When upgrading to PKS versions beyond 1.2.5 it is critical that you implement and maintain an ETCD certificate trust chain. 
For more information see <a href="https://community.pivotal.io/s/article/pks-upgrade-approach-for-critical-cve">PKS upgrade approach for CRITICAL CVE: 2019-3779 (67116)</a> in the Pivotal Support knowledge base.</p>

<p class="note"><strong>Note:</strong> PKS v1.2 has reached end of support life and is no longer supported. 
  You can instead upgrade PKS v1.2.8 to PKS v1.3.1+ by following the procedures in 
  <a href='https://community.pivotal.io/s/article/pks-upgrade-approach-for-critical-cve'>
  PKS upgrade approach for CRITICAL CVE: 2019-3779 (67116)</a> in the Pivotal Support Knowledge Base.
</p>

1. Determine your PKS v1.2.9+ migration path by reviewing [PKS upgrade approach for CRITICAL CVE: 2019-3779 (67116)](https://community.pivotal.io/s/article/pks-upgrade-approach-for-critical-cve)
in the Pivotal Support Knowledge Base.  
1. To upgrade PKS v1.2.8 to PKS v1.2.9+, repeat the upgrade procedures described above 
starting with [Step 3: Upgrade to PKS v1.2.6](#upgrade-tile). Note the following differences:
    * In [Step 3: Upgrade to PKS v1.2.6](#upgrade-tile), download the the desired PKS v1.2.9+ tile, 
    instead of the PKS v1.2.6 tile.
    * In [Step 4: Download and Import the Stemcell](#stemcell), download and import the stemcell required for the PKS version you are upgrading to.

During an upgrade your existing configuration settings automatically 
migrate to the new version.  

### <a id="upgrade-beyond-2-9"></a> (Optional) Step 14: Upgrade from PKS v1.2.9+ to a later PKS v1.2.x version

You can upgrade PKS v1.2.9+ directly to a later PKS v1.2.x version.  

<p class="note"><strong>Note:</strong> PKS v1.2 has reached end of support life and is no longer supported. 
  You can instead upgrade PKS v1.2.9 and later to PKS v1.3.2+.
</p>

1. To upgrade PKS v1.2.9+ to a later PKS v1.2.x version, repeat the upgrade procedures described above 
starting with [Step 3: Upgrade to PKS v1.2.6](#upgrade-tile). Note the following differences:
    * In [Step 3: Upgrade to PKS v1.2.6](#upgrade-tile) above, download the the desired PKS v1.2.9+ tile, instead of the PKS v1.2.6 tile.
    * In [Step 4: Download and Import the Stemcell](#stemcell), download and import the stemcell required for the PKS version you are upgrading to.

During an upgrade your existing configuration settings automatically 
migrate to the new version.  