---
title: Verifying Deployment Health
owner: PKS
---

<strong><%= modified_date %></strong>

This topic describes how to verify the health of your Pivotal Container Service
(PKS) deployment.

For the BOSH CLI commands in this topic, replace the text as follows:

* `ENV-NAME`: the alias you set for your BOSH Director. For more information, see
[Managing PKS Deployments with BOSH](manage-deployments-bosh.html).
* `PKS-DEPLOYMENT`: the name of your PKS installation. PKS deployment names begin with `pivotal-container-service` and include a unique BOSH-generated hash.
* `K8-DEPLOYMENT`: the name of your Kubernetes cluster deployment. Kubernetes cluster deployment names
begin with `service-instance_` and include a unique BOSH-generated hash.
* `VM-NAME`: your Kubernetes master node VM name.
* `VM-ID`: your Kubernetes master node VM ID. This is a unique BOSH-generated hash.

## <a id="k8s"></a>Verify Kubernetes Health

Verify the health of your Kubernetes environment by following the steps below:

1. From the Ops Manager VM, run the following command:
  <pre>bosh -e ENV-NAME login</pre>  

    For example:
    <pre class="terminal">$ bosh -e pks login</pre>

1. To verify that all nodes are in a ready state, run the following command for all Kubernetes contexts:  

    ```
    kubectl get nodes
    ```

1. To verify that all pods are running, run the following command for all Kubernetes contexts:  

    ```
    kubectl get pods --all-namespaces
    ```

1. To get the name of the target Kubernetes deployment, run the following command:  

    ```
    bosh deployments
    ```

    For example:  

    <img src="images/bosh-deployments.png" alt="BOSH Deployments" width="325">

    The name of the Kubernetes deployment begins with `service-instance_`.  In the example above, `service-instance_7e64d53fc570503b5690` is the Kubernetes deployment name.

  If you have deployed multiple Kubernetes clusters, you will need to first use `pks clusters` to get the UUID, then match that UUID with the service instance UUID you are targeting.

1. To get the status of the VMs comprising the target Kubernetes cluster, run the following command:  

    ```
    bosh -d K8-DEPLOYMENT vms
    ```

    This command returns the name of each VM comprising the Kubernetes cluster, including each master and worker node.  
<br>
    For example:
    <pre class="terminal">$ bosh e pks -d service-instance_8de000ff-a87a-4930-81ba-106d42c2471e vms</pre>

    <img src="images/bosh-vms.png" alt="Kubernetes VMs" width="325">

1. To verify that all the processes in the Kubernetes cluster are in a running state, run the following
command for each deployment:  

    ```
    bosh -d K8-DEPLOYMENT instances --ps
    ```

    For example:
    <pre class="terminal">$ bosh -d service-instance_8de000ff-a87a-4930-81ba-106d42c2471e instances --ps</pre>

    <img src="images/bosh-service-instance.png" alt="Kubernetes Service Instances" width="325">

## <a id="ncp"></a>Verify NCP Health (NSX-T Only)

NCP runs as a BOSH host process.
Each Kubernetes master node VM has one NCP process running. If your cluster has
multiple master nodes, one NCP process is active while the others are on standby. For more information, see [Architectural Changes](https://docs.pivotal.io/archives/pks-1-1.pdf). 

Verify NCP health by following the steps below:

1. Perform the steps in [Verify Kubernetes Health](#k8s) to view the VMs and process instances for your target Kubernetes cluster.

1. On the Master node, verify that the `ncp` process is `running`.

    <img src="images/bosh-ncp.png" alt="NCP Process" width="325">
1. To SSH into the Kubernetes master node VM, run the following command:  

    ```
    bosh -e ENV-NAME -d PKS-DEPLOYMENT ssh VM-NAME/VM-ID
    ```

    For example:
    <pre class="terminal">$ bosh -e pks -d pivotal-container-service-7e64d53fc570503b5690 ssh master/b6d3c263-1682-4c79-a9ab-35939127dedb</pre>

1. From the master node VM, run the following command:  

    ```
    monit summary
    ```

    Verify that you see `Process: 'ncp'` is `running`.

1. To check if the NCP process is active or on standby, run the following command:  

    ```
    /var/vcap/jobs/ncp/bin/nsxcli -c get ncp-master status
    ```

1. To restart the NCP process, run the following command:  

    ```
    monit restart ncp
    ```

1. To verify that the NCP process restarts successfully, run the following command:  

    ```
    monit summary
    ```
